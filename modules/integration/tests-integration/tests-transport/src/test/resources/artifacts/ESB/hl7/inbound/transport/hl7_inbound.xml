<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://ws.apache.org/ns/synapse">

    <sequence name="main">
        <in>
            <log level="full"/>
            <drop/>
        </in>
        <out>
            <send/>
        </out>
        <description>The main sequence for the message mediation</description>
    </sequence>

    <sequence name="genMain">
        <in>
            <property name="HL7_APPLICATION_ACK" value="true" scope="default"/>
            <payloadFactory media-type="xml">
                <format>
                    <hl7:message xmlns:hl7="http://wso2.org/hl7" xmlns="urn:hl7-org:v2xml">
                        <ACK xmlns="urn:hl7-org:v2xml">
                            <MSH>
                                <MSH.1>|</MSH.1>
                                <MSH.2>^~\&amp;</MSH.2>
                                <MSH.7>$1</MSH.7>
                                <MSH.9>
                                    <MSG.1>ACK</MSG.1>
                                    <MSG.2>A10</MSG.2>
                                </MSH.9>
                                <MSH.10>$2</MSH.10>
                                <MSH.11>
                                    <PT.1>T</PT.1>
                                </MSH.11>
                                <MSH.12>
                                    <VID.1>2.6</VID.1>
                                </MSH.12>
                            </MSH>
                            <MSA>
                                <MSA.1>$3</MSA.1>
                                <MSA.2>$4</MSA.2>
                            </MSA>
                        </ACK>
                    </hl7:message>
                </format>
                <args>
                    <arg expression="fn:concat(get-property('SYSTEM_DATE', 'yyyyMMddHHmmssz'))"/>
                    <arg value="CONTROLID"/>
                    <arg value="AA"/>
                    <arg value="REQUESTID"/>
                </args>
            </payloadFactory>
            <respond/>
        </in>
        <out>
            <send/>
        </out>
        <description>The main sequence for the message mediation</description>
    </sequence>

    <sequence name="fault">
        <!-- Generate a NACK containing the error -->
        <property name="HL7_RESULT_MODE" value="NACK"/>
        <property name="HL7_NACK_MESSAGE" expression="get-property('ERROR_MESSAGE')"/>
        <respond/>
    </sequence>
</definitions>